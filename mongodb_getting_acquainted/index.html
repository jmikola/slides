<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Zero to Sixty with MongoDB and PHP</title>
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

        <link rel="stylesheet" href="../vendor/reveal.js/css/reveal.css">
        <link rel="stylesheet" href="../vendor/highlight.js/src/styles/tomorrow-night-eighties.css">
        <link rel="stylesheet" href="../vendor/reveal.js/css/theme/default.css">
        <link rel="stylesheet" href="css/main.css">

        <script>
            if( window.location.search.match( /print-pdf/gi ) ) {
                var link = document.createElement('link');
                link.rel = 'stylesheet';
                link.type = 'text/css';
                link.href = '../vendor/reveal.js/css/print/pdf.css';
                document.getElementsByTagName('head')[0].appendChild(link);
            }
        </script>

        <!--[if lt IE 9]>
        <script src="../vendor/reveal.js/lib/js/html5shiv.js"></script>
        <![endif]-->
    </head>

    <body>
        <div class="reveal">
            <div class="slides">
                <section data-background="img/lego_racing.jpg" data-state="title" class="overlay">
                    <h1>Zero to Sixty with<br>MongoDB and PHP</h1>

                    <p class="bio">Jeremy Mikola<br><a href="http://twitter.com/jmikola">jmikola</a></p>
                </section>
<!--
                <section data-markdown data-state="about-mongodb">
                    <script type="text/template">
                        # <span class="mongodb-logo">MongoDB</span>

                        * Develops the MongoDB open-source project
                        * Provides support, training, and consulting
                        * Loves the community
                            * Mailing lists, IRC, and Stack Overflow
                            * Sponsors conferences and user groups
                        * Offices: NYC, Palo Alto, Europe, Australia
                        * Hiring at [mongodb.com/careers](http://mongodb.com/careers)
                    </script>
                </section>
-->
                <section data-background="img/highway.jpg" class="overlay">
                    <h2>Starting Off</h2>

                    <ul>
                        <li>What sets MongoDB apart?</li>
                        <li class="fragment">What are documents?</li>
                        <li class="fragment">How do we get up and running?</li>
                        <li class="fragment">What's in a driver?</li>
                        <li class="fragment">How do we read/write documents?</li>
                        <li class="fragment">What else can we do?</li>
                    </ul>
                </section>

                <section>
                    <section data-markdown>
                        <script type="text/template">
                            # Terminology

                            ```js
                            {
                                "mongodb"    : "relational db",
                                "database"   : "database",
                                "collection" : "table",
                                "document"   : "row",
                                "index"      : "index",
                                "_id"        : "primary key",
                                "sharding"   : {
                                    "shard"     : "partition",
                                    "shard key" : "partition key"
                                }
                            }
                            ```
                        </script>
                    </section>

                    <section data-markdown>
                        <script type="text/template">
                            ## RDBMS: The Good Parts

                            * Tried and true
                            * SQL is a rich query language
                            * ACID compliance
                            * Transactions
                        </script>
                    </section>

                    <section data-markdown>
                        <script type="text/template">
                            ## RDBMS: The Bad Parts

                            * Modeling complex or polymorphic data
                            * Schema migrations
                            * Administration
                            * Scalability trade-off
                        </script>
                    </section>

                    <section data-markdown>
                        <script type="text/template">
                            ## MongoDB: The Good Parts

                            * Document model
                            * Flexible schemas
                            * Scalability and performance
                            * Features (aggregation, geo, GridFS)
                        </script>
                    </section>

                    <section data-markdown>
                        <script type="text/template">
                            ## MongoDB: The Bad Parts

                            * Limited atomicity
                            * Consistency trade-off
                            * Query language limitations
                        </script>
                    </section>

                    <section data-state="database-landscape">
                        <h2>Database Landscape</h2>

                        <div class="diagram">
                            <ul>
                                <li class="memcached">Memcached</li>
                                <li class="key-value">Key/Value</li>
                                <li class="mongodb">MongoDB</li>
                                <li class="rdbms">RDBMS</li>
                            </ul>
                            <div class="y-axis">Scalability and Performance</div>
                            <div class="x-axis">Depth of Functionality</div>
                        </div>
                    </section>

                    <section data-markdown>
                        <script type="text/template">
                            # Why MongoDB?

                            > MongoDB has the best features of key/value stores, document databases and relational databases in one &mdash; [John Nunemaker](http://twitter.com/jnunemaker)
                        </script>
                    </section>
                </section>

                <section>
                    <section data-markdown data-state="relational-modeling">
                        <script type="text/template">
                            ## Relational Modeling

                            * Articles
                                * One author
                                * Many comments
                                * Many tags
                            * Authors
                                * Many articles
                                * Many comments
                            * Tags
                                * Many articles
                            * Comments
                                * One article
                                * One author
                        </script>
                    </section>

                    <section data-state="relational-diagram">
                        <h2>Relational Modeling</h2>

                        <table class="bordered" id="relational-articles">
                            <thead>
                                <tr><th colspan="4">articles</th></tr>
                                <tr>
                                    <th>id</th>
                                    <th>author_id</th>
                                    <th>title</th>
                                    <th>body</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>1</td>
                                    <td>2</td>
                                    <td>Praesent ante dui</td>
                                    <td>Lorem ipsumâ€¦</td>
                                </tr>
                            </tbody>
                        </table>

                        <table class="bordered" id="relational-articles-to-tags">
                            <thead>
                                <tr><th colspan="3">articles_to_tags</th></tr>
                                <tr>
                                    <th>id</th>
                                    <th>article_id</th>
                                    <th>tag_id</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>36</td>
                                    <td>1</td>
                                    <td>7</td>
                                </tr>
                                <tr>
                                    <td>37</td>
                                    <td>1</td>
                                    <td>8</td>
                                </tr>
                            </tbody>
                        </table>

                        <table class="bordered" id="relational-authors">
                            <thead>
                                <tr><th colspan="3">authors</th></tr>
                                <tr>
                                    <th>id</th>
                                    <th>name</th>
                                    <th>email</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>2</td>
                                    <td>Bob</td>
                                    <td>bob@example.com</td>
                                </tr>
                                <tr>
                                    <td>3</td>
                                    <td>John</td>
                                    <td>john@example.com</td>
                                </tr>
                            </tbody>
                        </table>

                        <table class="bordered" id="relational-comments">
                            <thead>
                                <tr><th colspan="4">comments</th></tr>
                                <tr>
                                    <th>id</th>
                                    <th>article_id</th>
                                    <th>author_id</th>
                                    <th>body</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>4</td>
                                    <td>1</td>
                                    <td>3</td>
                                    <td>Morbi libero eratâ€¦</td>
                                </tr>
                                <tr>
                                    <td>5</td>
                                    <td>1</td>
                                    <td>2</td>
                                    <td>Dapibus quisâ€¦</td>
                                </tr>
                                <tr>
                                    <td>6</td>
                                    <td>1</td>
                                    <td>3</td>
                                    <td>Fusce fermentumâ€¦</td>
                                </tr>
                            </tbody>
                        </table>

                        <table class="bordered" id="relational-tags">
                            <thead>
                                <tr><th colspan="2">tags</th></tr>
                                <tr>
                                    <th>id</th>
                                    <th>name</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>7</td>
                                    <td>luctus</td>
                                </tr>
                                <tr>
                                    <td>8</td>
                                    <td>rhoncus</td>
                                </tr>
                            </tbody>
                        </table>
                    </section>

                    <section data-background="img/sagecrm_schema.gif">
                        <h1 class="black">Things May Get<br>Out of Hand</h1>
                    </section>
                </section>

                <section>
                    <section data-markdown>
                        <script type="text/template">
                            ## Document Modeling

                            * Articles
                                * One author
                                * Many comments
                                    * One author
                                * Many tags
                        </script>
                    </section>

                    <section data-markdown>
                        <script type="text/template">
                            ## Document Modeling

                            ```js
                            {
                                _id: 1,
                                title: "Praesent ante dui",
                                body: "Lorem ipsumâ€¦",
                                author: { name: "Bob", email: "bob@example.com" },
                                comments: [
                                    {
                                        body: "Morbi libero eratâ€¦",
                                        author: { name: "John", email: "john@example.com" }
                                    },
                                    {
                                        body: "Dapibus quisâ€¦",
                                        author: { name: "Tom", email: "tom@example.com" }
                                    },
                                ],
                                tags: [ "luctus", "rhoncus" ]
                            }
                            ```
                        </script>
                    </section>
                </section>

                <section>
                    <section data-markdown>
                        <script type="text/template">
                            ## Documents are BSON

                            * [Binary JSON](http://bsonspec.org/)
                            * Zero or more key/value pairs
                            * Values are scalars, arrays, and objects
                            * Special types (e.g. binary strings, dates)
                        </script>
                    </section>

                    <section data-markdown>
                        <script type="text/template">
                            ## Documents in PHP

                            ```php
                            // Arrays are most common
                            $a = ['hello' => 'world'];

                            $b = ['things' => ['foo', 5.05, 2012]];
                            ```

                            ```php
                            // Objects work, too!
                            $a = new stdClass;
                            $a->hello = 'world';

                            $b = new stdClass;
                            $b->things = ['foo', 5.05, 2012];
                            ```
                        </script>
                    </section>
                </section>

                <section>
                    <section data-background="img/stopwatch_white.jpg">
                        <h1 class="black">Getting Up and Running with Mongo</h1>

                        <h3 class="black fragment">In 60 Seconds</h3>

                        <h6 class="black fragment">* Excluding download time :)</h6>
                    </section>

                    <section data-markdown>
                        <script type="text/template">
                            ## [mongodb.com/download-center](https://www.mongodb.com/download-center)

                            * Compiled binaries
                                * OS X, Linux, Windows, Solaris
                            * Packages
                                * MacPorts, Homebrew, Debian, CentOS
                            * Drivers for over a dozen languages
                        </script>
                    </section>

                    <section data-markdown>
                        <script type="text/template">
                            ## Installing

                            ```no-highlight
                            $ tar xvzf mongodb-linux-x86_64-ubuntu1604-3.2.10.tgz 
                            mongodb-linux-x86_64-ubuntu1604-3.2.10/README
                            mongodb-linux-x86_64-ubuntu1604-3.2.10/THIRD-PARTY-NOTICES
                            mongodb-linux-x86_64-ubuntu1604-3.2.10/MPL-2
                            mongodb-linux-x86_64-ubuntu1604-3.2.10/GNU-AGPL-3.0
                            mongodb-linux-x86_64-ubuntu1604-3.2.10/bin/mongodump
                            mongodb-linux-x86_64-ubuntu1604-3.2.10/bin/mongorestore
                            mongodb-linux-x86_64-ubuntu1604-3.2.10/bin/mongoexport
                            mongodb-linux-x86_64-ubuntu1604-3.2.10/bin/mongoimport
                            mongodb-linux-x86_64-ubuntu1604-3.2.10/bin/mongostat
                            mongodb-linux-x86_64-ubuntu1604-3.2.10/bin/mongotop
                            mongodb-linux-x86_64-ubuntu1604-3.2.10/bin/bsondump
                            mongodb-linux-x86_64-ubuntu1604-3.2.10/bin/mongofiles
                            mongodb-linux-x86_64-ubuntu1604-3.2.10/bin/mongooplog
                            mongodb-linux-x86_64-ubuntu1604-3.2.10/bin/mongoperf
                            mongodb-linux-x86_64-ubuntu1604-3.2.10/bin/mongosniff
                            mongodb-linux-x86_64-ubuntu1604-3.2.10/bin/mongod
                            mongodb-linux-x86_64-ubuntu1604-3.2.10/bin/mongos
                            mongodb-linux-x86_64-ubuntu1604-3.2.10/bin/mongo
                            ```
                        </script>
                    </section>

                    <section data-markdown>
                        <script type="text/template">
                            ## Starting

                            ```no-highlight
                            $ mkdir /data/db

                            $ mongodb-linux-x86_64-ubuntu1604-3.2.10/bin/mongod
                            [initandlisten] MongoDB starting : pid=20751 port=27017 dbpath=/data/db 64-bit host=honeydew
                            [initandlisten] db version v3.2.10
                            [initandlisten] git version: 79d9b3ab5ce20f51c272b4411202710a082d0317
                            [initandlisten] OpenSSL version: OpenSSL 1.0.2g  1 Mar 2016
                            [initandlisten] allocator: tcmalloc
                            [initandlisten] modules: none
                            [initandlisten] build environment:
                            [initandlisten]     distmod: ubuntu1604
                            [initandlisten]     distarch: x86_64
                            [initandlisten]     target_arch: x86_64
                            [initandlisten] options: { storage: { dbPath: "/tmp/db" } }
                            [initandlisten] wiredtiger_open config: create,cache_size=8G,session_max=20000,eviction=(threads_max=4),config_base=false,statistics=(fast),log=(enabled=true,archive=true,path=journal,compressor=snappy),file_manager=(close_idle_time=100000),checkpoint=(wait=60,log_size=2GB),statistics_log=(wait=0),
                            [initandlisten] Initializing full-time diagnostic data capture with directory '/tmp/db/diagnostic.data'
                            [initandlisten] waiting for connections on port 27017
                            ```
                        </script>
                    </section>

                    <section data-markdown>
                        <script type="text/template">
                            ## Connecting

                            ```no-highlight
                            $ mongodb-linux-x86_64-ubuntu1604-3.2.10/bin/mongo
                            MongoDB shell version: 3.2.10
                            connecting to: test

                            > show dbs
                            local   (empty)

                            > db.foo.insert({x: 1})

                            > db.foo.find()
                            { "_id" : ObjectId("57f7aefab586b9ceed2df190"), "x" : 1 }
                            ```
                        </script>
                    </section>

                    <section data-markdown>
                        <script type="text/template">
                            ## MongoDB Atlas

                            * Hosted MongoDB as a Service
                            * Single-click deployments, upgrades, etc.
                            * Configurable scalability and redundancy
                            * Integration with MongoDB's backup service
                            * Secure (authentication, encryption, IP whitelists)

                            <br>

                            More info at [mongodb.com/cloud](https://www.mongodb.com/cloud)
                        </script>
                    </section>

                    <section data-markdown>
                        <script type="text/template">
                            ## PHP and HHVM Drivers

                            * [PHP](https://github.com/mongodb/mongo-php-driver) and [HHVM](https://github.com/mongodb/mongo-hhvm-driver) extensions (`ext-mongodb`)
                              * Client, server, and cursor classes
                              * BSON types and encode/decode functions
                            * [PHP library](https://github.com/mongodb/mongo-php-library) (`mongodb/mongodb`)
                              * Client, database, and collection classes
                              * Higher-level abstractions (e.g. GridFS)
                            * Installing the [extension](http://php.net/manual/en/mongodb.installation.php) and [library](http://php.net/manual/en/mongodb.tutorial.library.php)
                        </script>
                    </section>
                </section>

                <section>
                    <section data-background="img/panda_pan.jpg">
                        <h1>Let's Get Cooking</h1>
                    </section>

                    <section data-markdown>
                        <script type="text/template">
                            ## Core Classes

                            * [MongoDB\Client](https://docs.mongodb.com/php-library/master/reference/class/MongoDBClient/)
                            * [MongoDB\Database](https://docs.mongodb.com/php-library/master/reference/class/MongoDBDatabase/)
                            * [MongoDB\Collection](https://docs.mongodb.com/php-library/master/reference/class/MongoDBCollection/)
                            * [MongoDB\Driver\Cursor](http://php.net/manual/en/class.mongodb-driver-cursor.php)
                        </script>
                    </section>

                    <section data-markdown>
                        <script type="text/template">
                            ## Connecting

                            ```php
                            // 127.0.0.1:27017
                            $m = new MongoDB\Client;

                            // example.com:27018
                            $m = new MongoDB\Client('mongodb://example.com:27018');

                            // authentication
                            $m = new MongoDB\Client('mongodb://user:password@localhost');

                            // replica set
                            $m = new MongoDB\Client(
                                'mongodb://rs1.example.com,rs2.example.com',
                                ['replicaSet' => 'myReplSet']
                            );
                            ```
                        </script>
                    </section>

                    <section data-markdown>
                        <script type="text/template">
                            ## The MongoDB\Client Class

                            ```php
                            $m = new MongoDB\Client;

                            // Select the "test" database
                            $db = $m->test;
                            $db = $m->selectDatabase('test');

                            // Select the "test.users" collection
                            $c = $m->test->users;
                            $c = $m->selectCollection('test', 'users');
                            ```
                        </script>
                    </section>

                    <section data-markdown>
                        <script type="text/template">
                            ## The MongoDB\Database Class

                            ```php
                            $db = $m->test;
                            $db = new MongoDB\Database($m->getManager(), 'test');

                            // Select the "test.users" collection
                            $c = $db->users;
                            $c = $db->selectCollection('users');

                            // Execute a command on the "test" database
                            $cursor = $db->command(['serverStatus' => 1]);
                            $serverStatus = $cursor->toArray()[0];
                            ```
                        </script>
                    </section>

                    <section data-markdown>
                        <script type="text/template">
                            ## The MongoDB\Collection Class

                            ```php
                            $c = $db->users;
                            $c = new MongoDB\Collection($db->getManager(), 'test', 'users');

                            // Insert a user document for Bob
                            $c->insertOne(['username' => 'bob', 'roles' => ['admin']]);

                            // Retrieve Bob's user document
                            $user = $c->findOne(['username' => 'bob']);

                            // Find all admins (returns an iterable MongoDB\Driver\Cursor)
                            $cursor = $c->find(['roles' => 'admin']);
                            $admins = $cursor->toArray();
                            ```
                        </script>
                    </section>

                    <section data-markdown>
                        <script type="text/template">
                            ## The MongoDB\Collection Class

                            ```php
                            $c->count();                     // Count all users
                            $c->count(['roles' => 'admin']); // Count only admins

                            $c->deleteOne(['username' => 'john']); // Delete a user
                            $c->deleteMany();                      // Delete all users
                            ```
                        </script>
                    </section>
                </section>

                <section>
                    <section>
                        <h1>Identifiers and Types</h1>
                    </section>

                    <section data-markdown>
                        <script type="text/template">
                            ## Identifiers

                            ```php
                            // Create a user document for Tom
                            $result = $c->insertOne(['username' => 'tom']);

                            var_dump($result->getInsertedCount());
                            var_dump($result->getInsertedId());
                            ```

                            ```no-highlight
                            int(1)
                            object(MongoDB\BSON\ObjectID)#11 (1) {
                              ["oid"]=>
                              string(24) "57f7d220da14d803b94fba92"
                            }
                            ```
                        </script>
                    </section>

                    <section data-markdown>
                        <script type="text/template">
                            ## The `_id` Field

                            * Its value is immutable
                            * Unique to the collection
                            * ObjectID, scalar or object
                            * Indexed by default
                        </script>
                    </section>

                    <section>
                        <h2>What's in an ObjectID?</h2>

                        <table class="bordered">
                            <tr>
                                <td><code>57f7d220</code></td>
                                <td><code>da14d8</code></td>
                                <td><code>03b9</code></td>
                                <td><code>4fba92</code></td>
                            </tr>
                            <tr>
                                <td>Timestamp</td>
                                <td>Hostname</td>
                                <td>PID</td>
                                <td>Sequence</td>
                            </tr>
                        </table>

                        <ul>
                            <li>12-byte, binary string</li>
                            <li>Safely generated in distributed environments</li>
                            <li>Timestamp prefix useful for sorting</li>
                        </ul>
                    </section>

                    <section data-markdown data-state="driver-type-classes">
                        <script type="text/template">
                            ## BSON Type Classes

                            * [MongoDB\BSON\Binary](http://php.net/manual/en/class.mongodb-bson-binary.php)
                            * [MongoDB\BSON\Javascript](http://php.net/manual/en/class.mongodb-bson-javascript.php)
                            * [MongoDB\BSON\ObjectID](http://php.net/manual/en/class.mongodb-bson-objectid.php)
                            * [MongoDB\BSON\Regex](http://php.net/manual/en/class.mongodb-bson-regex.php)
                            * [MongoDB\BSON\Timestamp](http://php.net/manual/en/class.mongodb-bson-timestamp.php)
                            * [MongoDB\BSON\UTCDateTime](http://php.net/manual/en/class.mongodb-bson-utcdatetime.php)
                            * [MongoDB\Model\BSONArray](https://docs.mongodb.com/php-library/master/reference/bson/)
                            * [MongoDB\Model\BSONDocument](https://docs.mongodb.com/php-library/master/reference/bson/)
                        </script>
                    </section>
                </section>

                <section>
                    <section data-background="img/lego_writing.jpg">
                        <h1>Writing</h1>
                    </section>

                    <section data-markdown>
                        <script type="text/template">
                            ## Writing to MongoDB

                            * Inserts, updates, and upserts
                            * Consistency/performance options
                            * Avoid shooting yourself in the foot
                        </script>
                    </section>

                    <section data-markdown>
                        <script type="text/template">
                            ## Write Concern

                            * `{w: 0}`
                                * Fire and forget
                                * Trade consistency for performance
                            * `{w: 1}`
                                * Ensure primary acknowledges write
                            * `{w: #}` or `{w: "majority"}`
                                * Wait for multiple acknowledgements
                        </script>
                    </section>

                    <section data-markdown>
                        <script type="text/template">
                            ## Acknowledged Writes

                            ```php
                            $c = (new MongoDB\Client)->test->users;

                            $user = $c->findOne(['username' => 'tom']);

                            // MongoDB\Client's default behavior
                            $result = $c->insertOne(
                                $user,
                                ['writeConcern' => new MongoDB\Driver\WriteConcern(1)]
                            );

                            var_dump($result->getInsertedCount());
                            ```

                            ```no-highlight
                            Uncaught MongoDB\Driver\Exception\BulkWriteException:
                              E11000 duplicate key error
                              collection: test.users
                              index: _id_
                              dup key: { : ObjectId('57f7d220da14d803b94fba92') }
                            ```
                        </script>
                    </section>

                    <section data-markdown>
                        <script type="text/template">
                            ## Acknowledged Writes

                            ```php
                            // Connect to a replica set URI
                            $c = (new MongoDB\Client('...'))->test->users;

                            $result = $c->insertOne(
                                ['username' => 'tom'],
                                ['writeConcern' => new MongoDB\Driver\WriteConcern(2)]
                            );

                            var_dump($result->getInsertedCount()); // int(1)
                            ```
                        </script>
                    </section>

                    <section data-markdown>
                        <script type="text/template">
                            ## Unacknowledged Writes

                            ```php
                            $c = (new MongoDB\Client)->test->users;

                            $user = $c->findOne(['username' => 'tom']);

                            $result = $c->insertOne(
                                $user,
                                ['writeConcern' => new MongoDB\Driver\WriteConcern(0)]
                            );

                            var_dump($result->isAcknowledged());
                            ```

                            ```no-highlight
                            bool(false)
                            ```
                        </script>
                    </section>

                    <section data-markdown>
                        <script type="text/template">
                            ## Updating a Document

                            ```php
                            // Change Tom's email address
                            $result = $c->updateOne(
                                ['username' => 'tom'],
                                ['$set' => ['email' => 'thomas@example.com']]
                            );

                            var_dump($result->getMatchedCount());  // int(1)
                            var_dump($result->getModifiedCount()); // int(1)
                            ```

                            * Criteria
                            * New object
                                * Overwrite entire document
                                * Apply atomic operations
                        </script>
                    </section>

                    <section data-markdown>
                        <script type="text/template">
                            ## Updating Multiple Documents

                            ```php
                            // Make everyone an admin (probably a bad idea :)
                            $result = $c->updateMany(
                                [],
                                ['$addToSet' => ['roles' => 'admin']]
                            );

                            var_dump($result->getMatchedCount());  // int(9)
                            var_dump($result->getModifiedCount()); // int(9)
                            ```
                        </script>
                    </section>

                    <section data-markdown>
                        <script type="text/template">
                            ## Upserting

                            ```php
                            // If Sam doesn't exist, insert: { username: "Sam", role: "staff" }
                            $result = $c->updateOne(
                                ['username' => 'sam'],
                                ['$set' => ['role' => 'staff']],
                                ['upsert' => true]
                            );

                            var_dump($result->getMatchedCount());  // int(0)
                            var_dump($result->getModifiedCount()); // int(0)
                            var_dump($result->getUpsertedCount()); // int(1)
                            var_dump($result->getUpsertedId());    // object(MongoDB\BSON\ObjectID)
                            ```

                            * No multi-document operation
                            * Does the criteria match a document?
                                * Yes, update the document
                                * No, [apply modifiers to criteria and insert](https://docs.mongodb.com/manual/tutorial/update-documents/#upsert-option)
                        </script>
                    </section>

                    <section data-markdown data-state="atomic-operators">
                        <script type="text/template">
                            ## [Update Operators](https://docs.mongodb.com/manual/reference/operator/update/)

                            * Mixed
                                * [$currentDate](https://docs.mongodb.com/manual/reference/operator/update/currentDate/)
                                * [$rename](https://docs.mongodb.com/manual/reference/operator/update/rename/)
                                * [$set](https://docs.mongodb.com/manual/reference/operator/update/set/)
                                * [$unset](https://docs.mongodb.com/manual/reference/operator/update/unset/)
                            * Arrays
                                * [$addToSet](https://docs.mongodb.com/manual/reference/operator/update/addToSet/)
                                * [$pop](https://docs.mongodb.com/manual/reference/operator/update/pop/)
                                * [$pull](https://docs.mongodb.com/manual/reference/operator/update/pull/), [$pullAll](https://docs.mongodb.com/manual/reference/operator/update/pullAll/)
                                * [$push](https://docs.mongodb.com/manual/reference/operator/update/push/), [$pushAll](https://docs.mongodb.com/manual/reference/operator/update/pushAll/)
                            * Numbers
                                * [$bit](https://docs.mongodb.com/manual/reference/operator/update/bit/)
                                * [$inc](https://docs.mongodb.com/manual/reference/operator/update/inc/)
                                * [$mul](https://docs.mongodb.com/manual/reference/operator/update/mul/)
                        </script>
                    </section>

                    <section data-markdown>
                        <script type="text/template">
                            ## [Positional Updates](https://docs.mongodb.com/manual/reference/operator/update/positional/)

                            ```php
                            $c = (new MongoDB\Client)->test->articles;

                            // An article with votable comments
                            $c->insertOne([
                                '_id' => 1,
                                'title' => 'Praesent ante dui',
                                'comments' => [
                                    ['id' => 1, 'votes' => 2, 'text' => 'Dapibus quisâ€¦'],
                                    ['id' => 2, 'votes' => 0, 'text' => 'Fusce fermentumâ€¦'],
                                ],
                            ]);

                            // Upvote the second comment
                            $c->updateOne(
                                ['_id' => 1, 'comments.id' => 2],
                                ['$inc' => ['comments.$.votes' => 1]]
                            );
                            ```
                        </script>
                    </section>
                </section>

                <section>
                    <section data-background="img/lego_sherlock.jpg">
                        <h1>Queries</h1>
                    </section>

                    <section data-markdown>
                        <script type="text/template">
                            ## Basic Querying

                            ```php
                            $c->findOne(); // Retrieve one document as an array
                            $c->find();    // Find all documents via MongoDB\Driver\Cursor

                            // Query on field values
                            $c->findOne(['lastName' => 'Smith']);
                            $c->find(['roles' => 'admin']);
                            ```

                            * Query criteria is BSON
                            * No grammar to parse
                        </script>
                    </section>

                    <section data-markdown>
                        <script type="text/template">
                            ## Queries Return Cursors

                            * Cursors navigate a query result
                            * Can be iterated forward and only once
                            * Convert to an array for random access
                            * Commands return cursors, too
                        </script>
                    </section>

                    <section data-markdown>
                        <script type="text/template">
                            ## The MongoDB\Driver\Cursor Class

                            ```php
                            $cursor = $c->find(
                                ['roles' => 'admin'],             // Find all admins
                                [
                                    'sort' => ['username' => -1], // Desc sort by username
                                    'limit' => 10,                // Limit to 10 results
                                    'skip' => 5,                  // Skip the first 5
                                ]
                            );

                            // Iterate through results
                            foreach ($cursor as $document) { }

                            // Get them all at once (equivalent to iterator_to_array())
                            $results = $cursor->toArray();
                            ```
                        </script>
                    </section>

                    <section data-markdown data-background="img/business_requirements.jpg" class="overlay">
                        <script type="text/template">
                            # Ad-hoc Querying

                            ### Arbitrary Business Requirement #42789!

                            We need the usernames for all admins that use Gmail and whose accounts were created within the last year.
                        </script>
                    </section>

                    <section data-markdown>
                        <script type="text/template">
                            ## Data to Query

                            ```php
                            $c = (new MongoDB\Client)->test->users;

                            $c->insertOne([
                                'username' => 'bob',
                                'email' => 'bob@example.com',
                                'profile' => [
                                    'bio' => 'I am a data fixture.',
                                    'createdAt' => new MongoDB\BSON\UTCDateTime,
                                ],
                                'roles' => ['moderator', 'admin'],
                            ]);

                            // Among othersâ€¦
                            ```
                        </script>
                    </section>

                    <section data-markdown>
                        <script type="text/template">
                            ## Complex Criteria

                            * [Regular expressions](https://docs.mongodb.com/manual/reference/operator/query/regex/)
                            * [Matching values in embedded objects](https://docs.mongodb.com/manual/core/document/#document-dot-notation)
                            * [Comparison operators](https://docs.mongodb.com/manual/reference/operator/query-comparison/)
                            * [Matching a value in an array](https://docs.mongodb.com/manual/tutorial/query-documents/#query-on-arrays)
                        </script>
                    </section>

                    <section data-markdown>
                        <script type="text/template">
                            ## Complex Criteria

                            ```php
                            $lastYear = new DateTime('last year');

                            // Arbitrary Business Requirement #42789!
                            $cursor = $c->find(
                                [
                                    'email' => new MongoDB\BSON\Regex('gmail\.com$', 'i'),
                                    'profile.createdAt' => [
                                        '$gt' => new MongoDB\BSON\UTCDateTime($lastYear),
                                    ],
                                    'roles' => 'admin',
                                ]
                            );
                            ```
                        </script>
                    </section>

                    <section data-markdown>
                        <script type="text/template">
                            ## Field Projection

                            ```php
                            // Limit returned fields to the username
                            $cursor = $c->find(
                                [
                                    'email' => new MongoDB\BSON\Regex('gmail\.com$', 'i'),
                                    'profile.createdAt' => [
                                        '$gt' => new MongoDB\BSON\UTCDateTime($lastYear),
                                    ],
                                    'roles' => 'admin',
                                ],
                                [
                                    'projection' => ['username' => 1],
                                ]
                            );
                            ```

                            * [Retrieving a subset of fields](https://docs.mongodb.com/manual/reference/method/db.collection.find/#find-projection)
                            * [Retrieving a slice of an array](https://docs.mongodb.com/manual/reference/operator/projection/slice/)
                        </script>
                    </section>

                    <section data-markdown data-state="query-operators">
                        <script type="text/template">
                            ## [Query Operators](https://docs.mongodb.com/manual/reference/operator/query/)

                            * Comparison
                                * [$gt](https://docs.mongodb.com/manual/reference/operator/query/gt/), [$gte](https://docs.mongodb.com/manual/reference/operator/query/gte/)
                                * [$lt](https://docs.mongodb.com/manual/reference/operator/query/lt/), [$lte](https://docs.mongodb.com/manual/reference/operator/query/lte/)
                                * [$ne](https://docs.mongodb.com/manual/reference/operator/query/ne/)
                            * Logical
                                * [$and](https://docs.mongodb.com/manual/reference/operator/query/and/)
                                * [$or](https://docs.mongodb.com/manual/reference/operator/query/or/), [$nor](https://docs.mongodb.com/manual/reference/operator/query/nor/)
                                * [$not](https://docs.mongodb.com/manual/reference/operator/query/not/)
                            * Arrays
                                * [$all](https://docs.mongodb.com/manual/reference/operator/query/all/)
                                * [$in](https://docs.mongodb.com/manual/reference/operator/query/in/), [$nin](https://docs.mongodb.com/manual/reference/operator/query/nin/)
                                * [$size](https://docs.mongodb.com/manual/reference/operator/query/size/)
                                * [$elemMatch](https://docs.mongodb.com/manual/reference/operator/query/elemMatch/)
                            * Misc
                                * [$exists](https://docs.mongodb.com/manual/reference/operator/query/exists/)
                                * [$mod](https://docs.mongodb.com/manual/reference/operator/query/mod/)
                                * [$text](https://docs.mongodb.com/manual/reference/operator/query/text/)
                                * [$type](https://docs.mongodb.com/manual/reference/operator/query/type/)
                                * [$where](https://docs.mongodb.com/manual/reference/operator/query/where/)
                            * Geo
                                * [$geoWithin](https://docs.mongodb.com/manual/reference/operator/query/geoWithin/)
                                * [$geoIntersects](https://docs.mongodb.com/manual/reference/operator/query/geoIntersects/)
                                * [$near](https://docs.mongodb.com/manual/reference/operator/query/near/)
                                * [$nearSphere](https://docs.mongodb.com/manual/reference/operator/query/nearSphere/)
                        </script>
                    </section>
                </section>

                <section>
                    <section data-background="img/pickles.jpg" class="overlay">
                        <h1>An Atomic Pickle</h1>

                        <ul>
                            <li>We can query for things</li>
                            <li class="fragment">We can update documents atomically</li>
                            <li class="fragment">Can we atomically query <em>and</em> update?</li>
                        </ul>
                    </section>

                    <section data-markdown>
                        <script type="text/template">
                            ## Data to Process

                            ```php
                            $c = (new MongoDB\Client)->test->jobs;

                            $c->insertOne([
                                'task' => 'â€¦',
                                'inprogress' => 'false',
                                'priority' => 1
                            ]);

                            $c->insertOne([
                                'task' => 'â€¦',
                                'inprogress' => 'false',
                                'priority' => 4
                            ]);
                            ```
                        </script>
                    </section>

                    <section data-markdown>
                        <script type="text/template">
                            ## [Find and Modify](https://docs.mongodb.com/manual/reference/command/findAndModify/) a Document

                            ```php
                            use MongoDB\Operation\FindOneAndUpdate;

                            $c->findOneAndUpdate(
                                ['inprogress' => false],
                                ['$set' => [
                                    'inprogress' => true,
                                    'startedAt' => new MongoDB\BSON\UTCDateTime,
                                ]],
                                [
                                    'returnDocument' => FindOneAndUpdate::RETURN_DOCUMENT_AFTER,
                                    'sort' => ['priority' => -1],
                                ]
                            );
                            ```

                            * Atomically select and modify one document
                            * Update, upsert, replace, or delete the document
                            * Return document in pre- or post-modified state
                        </script>
                    </section>
                </section>

                <section>
                    <section data-background="img/rolodex.jpg">
                        <h1>Indexing</h1>
                    </section>

                    <section data-markdown>
                        <script type="text/template">
                            ## Indexes in MongoDB

                            * B-trees
                            * Multiple indexes per collection
                            * Any field(s), top-level or embedded
                            * [Multi-key indexes for array values](https://docs.mongodb.com/manual/core/index-multikey/)
                            * [Sparse](https://docs.mongodb.com/manual/indexes/#sparse-indexes), [unique](https://docs.mongodb.com/manual/indexes/#unique-indexes), [geospatial](https://docs.mongodb.com/manual/indexes/#geospatial-indexes), [text](https://docs.mongodb.com/manual/core/index-text/), and [TTL](https://docs.mongodb.com/manual/tutorial/expire-data/)
                        </script>
                    </section>

                    <section data-markdown>
                        <script type="text/template">
                            ## Managing Indexes

                            ```php
                            $c = (new MongoDB\Client)->test->things;

                            // Ensure unique values for x (just like the _id index)
                            $c->createIndex(['x' => 1], ['unique' => true]);

                            // Delegate index creation as a background task
                            $c->createIndex(['x' => 1], ['background' => true]);

                            // Obtain an iterator of MongoDB\Model\IndexInfo objects
                            $indexInfoIterator = $c->listIndexes();

                            $c->dropIndex('x_1'); // Delete an index by name
                            $c->dropIndexes();    // Delete all indexes for the collection
                            ```
                        </script>
                    </section>

                    <section data-markdown>
                        <script type="text/template">
                            ## Compound Indexes

                            ```php
                            $c->createIndex(['x' => 1, 'y' => 1, 'z' => -1]);

                            // These queries will use the index
                            $c->find(['x' => 'foo']);
                            $c->find(['x' => 'foo', 'y' => ['$gt' => 5]]);
                            $c->find(
                                ['x' => 'foo', 'y' => 4],
                                ['sort' => ['z' => -1]]
                            );
                            $c->find(['x' => "foo", 'y' => 8, 'z' => 'baz']);

                            // This query will not by default
                            $c->find(['y' => 6]);
                            ```

                            * Index multiple fields
                            * Direction per field (range queries, sorting)
                            * Usable for constituent field queries
                        </script>
                    </section>
<!--
                    <section data-markdown>
                        <script type="text/template">
                            ## Explain Your Queries

                            ```php
                            $cursor = $c->find(['x' => 'foo']);
                            $cursor->explain();
                            ```

                            ```php
                            array(
                              "cursor" => "BtreeCursor x_1", // BasicCursor? à² _à² 
                              "isMultiKey" => false,
                              "n" => 0,
                              "nscannedObjects" => 3,
                              "nscanned" => 3,
                              "indexOnly" => false,
                              "nYields" => 0,
                              "millis" => 0,
                              "indexBounds" => array(â€¦),
                            )
                            ```

                            * Documentation for [explain output](http://docs.mongodb.org/manual/reference/method/cursor.explain/#explain-output-fields-core)
                        </script>
                    </section>
-->
                    <section data-markdown>
                        <script type="text/template">
                            ## Performance Tips

                            * [Keep your indexes and working set in RAM](https://docs.mongodb.com/manual/tutorial/ensure-indexes-fit-ram/)
                            * [Mind your read/write ratio](https://docs.mongodb.com/manual/faq/indexes/#how-do-write-operations-affect-indexes)
                            * [Support multiple queries per index](https://docs.mongodb.com/manual/tutorial/create-indexes-to-support-queries/)
                            * Avoid non-indexed queries and table scans
                            * [Create indexes that ensure selectivity](https://docs.mongodb.com/manual/tutorial/create-queries-that-ensure-selectivity/)
                            * [Indexing advice and FAQ](https://docs.mongodb.com/manual/faq/indexes/)
                        </script>
                    </section>
                </section>

                <section>
                    <section>
                        <h1>Database Commands</h1>
                    </section>

                    <section data-markdown data-state="commands">
                        <script type="text/template">
                            ## Database Commands

                            * `findOne` queries on special `$cmd` collection
                            * Shell and driver helpers for some
                            * [MongoDB\Database::command()](https://docs.mongodb.com/php-library/master/reference/method/MongoDBDatabase-command/) for the rest
                            * [Reference list](https://docs.mongodb.com/manual/reference/command/)
                                * Sharding
                                * Replication
                                * Aggregation
                                * Collections
                                * Indexing
                                * Geospatial
                                * Diagnostic
                                * Administration
                        </script>
                    </section>
                </section>

                <section>
                    <section data-background="img/lego_counting.jpg">
                        <h1>Aggregation</h1>
                    </section>

                    <section data-markdown>
                        <script type="text/template">
                            ## Aggregation

                            * [Aggregation framework](https://docs.mongodb.com/manual/core/aggregation-pipeline/)
                            * [Single-purpose aggregation commands](https://docs.mongodb.com/manual/aggregation/#single-purpose-aggregation-operations)
                            * [MapReduce](https://docs.mongodb.com/manual/core/map-reduce/)
                            * [Hadoop adapter](https://docs.mongodb.com/ecosystem/tools/hadoop/)
                        </script>
                    </section>

                    <section data-markdown data-background="img/business_requirements.jpg" class="overlay">
                        <script type="text/template">
                            # Reporting

                            ### Arbitrary Business Requirement #27533!

                            We need a report listing all authors that have written an article for each tag category.
                        </script>
                    </section>

                    <section data-markdown>
                        <script type="text/template">
                            ## Data to Aggregate

                            ```php
                            $c = (new MongoDB\Client)->test->articles;

                            $c->insertOne(['author' => 'jen', 'tags' => ['politics', 'tech']]);
                            $c->insertOne(['author' => 'sue', 'tags' => ['business']]);
                            $c->insertOne(['author' => 'tom', 'tags' => ['sports']]);
                            $c->insertOne([
                                'author' => 'bob',
                                'tags' => ['business', 'sports', 'tech']
                            ]);
                            ```
                        </script>
                    </section>

                    <section data-markdown>
                        <script type="text/template">
                            ## Map<span style="opacity:0.5;">Reduce</span>

                            ```php
                            $map = '
                            function() {
                                for (var i = 0; i < this.tags.length; i++) {
                                    emit(this.tags[i], { authors: [this.author] });
                                }
                            }';
                            ```
                        </script>
                    </section>

                    <section data-markdown>
                        <script type="text/template">
                            ## <span style="opacity:0.5">Map</span>Reduce

                            ```php
                            $reduce = '
                            function(key, values) {
                                var result = { authors: [] };

                                values.forEach(function(value) {
                                    value.authors.forEach(function(author) {
                                        if (-1 == result.authors.indexOf(author)) {
                                            result.authors.push(author);
                                        }
                                    });
                                });

                                return result;
                            }';
                            ```
                        </script>
                    </section>

                    <section data-markdown>
                        <script type="text/template">
                            ## MapReduce

                            ```php
                            $db = (new MongoDB\Client)->test;

                            $cursor = $db->command([
                                'mapreduce' => 'articles',
                                'map' => new MongoDB\BSON\Javascript($map),
                                'reduce' => new MongoDB\BSON\Javascript($reduce),
                                'out' => ['inline' => true],
                            ]);

                            foreach ($cursor->toArray()[0]['results'] as $r) {
                                $authors = implode(', ', $r['value']['authors']);
                                printf("%s: %s\n", $r['_id'], $authors);
                            }
                            ```

                            ```no-highlight
                            business: sue, bob
                            politics: jen
                            sports: tom, bob
                            tech: jen, bob
                            ```
                        </script>
                    </section>

                    <section data-markdown>
                        <script type="text/template">
                            ## Aggregation Framework

                            ```php
                            $c = (new MongoDB\Client)->test->articles;

                            $cursor = $c->aggregate([
                                ['$unwind' => '$tags'],
                                ['$group' => [
                                    '_id' => '$tags',
                                    'authors' => ['$addToSet' => '$author'],
                                ]],
                            ]);

                            foreach ($cursor as $r) {
                                $authors = implode(', ', $r['authors']);
                                printf("%s: %s\n", $r['_id'], $authors);
                            }
                            ```

                            ```no-highlight
                            business: bob, sue
                            tech: bob, jen
                            sports: bob, tom
                            politics: jen
                            ```
                        </script>
                    </section>
                </section>

                <section>
                    <section data-background="img/container_ship.jpg">
                        <h1>GridFS</h1>
                    </section>

                    <section data-markdown>
                        <script type="text/template">
                            ## [GridFS](https://docs.mongodb.com/manual/core/gridfs/)

                            * File storage within MongoDB
                            * BSON collections
                                * `fs.files`: metadata document
                                * `fs.chunks`: binary data (1+ per file)
                            * MongoDB\GridFS\Bucket and [PHP Streams](http://php.net/manual/en/book.stream.php)
                        </script>
                    </section>

                    <section data-markdown>
                        <script type="text/template">
                            ## The MongoDB\GridFS\Bucket Class

                            ```php
                            $db = (new MongoDB\Client)->test;

                            // Default prefix (fs.files and fs.chunks)
                            $b = $db->selectGridFSBucket();
                            $b = new MongoDB\GridFS\Bucket(
                                $db->getManager(),
                                $db->getDatabaseName()
                            );

                            // Custom prefix (images.files and images.chunks)
                            $b = $db->selectGridFSBucket(['bucketName' => 'images']);
                            $b = new MongoDB\GridFS\Bucket(
                                $db->getManager(),
                                $db->getDatabaseName(),
                                ['bucketName' => 'images']
                            );
                            ```
                        </script>
                    </section>

                    <section data-markdown>
                        <script type="text/template">
                            ## Storing Files

                            ```php
                            // Upload a file and return its _id
                            $source = fopen('/path/to/file', 'rb');
                            $id = $b->uploadFromStream('filename', $source);

                            // Upload bytes to a file and return its _id
                            $stream = $b->openUploadStream('filename');
                            $id = $b->getFileIdForStream($stream);
                            fwrite($stream, 'foobar');
                            fclose($stream);
                            ```
                        </script>
                    </section>

                    <section data-markdown>
                        <script type="text/template">
                            ## Retrieving Files

                            ```php
                            // Download a file by its _id
                            $id = new MongoDB\BSON\ObjectID('57f81b38da14d802e97b1b72');
                            $destination = fopen('/path/to/file', 'w+b');
                            $b->downloadToStream($id, $destination);

                            // Open a readable stream for a file by its _id
                            $stream = $b->openDownloadStream($id);
                            $contents = stream_get_contents($stream);

                            // Download a file by its filename
                            $destination = fopen('/path/to/file', 'w+b');
                            $b->downloadToStreamByName('filename', $destination);

                            // Open a readable stream for a file by its filename
                            $stream = $b->openDownloadStreamByName('filename');
                            $contents = stream_get_contents($stream);
                            ```

                            * `filename` is not necessarily unique
                            * Same `filename` and different `uploadDate` &rarr; revision
                        </script>
                    </section>

                    <section data-markdown>
                        <script type="text/template">
                            ## Retrieving Files by Revision

                            ```php
                            // Open the most recent revision (default behavior)
                            $stream = $b->openDownloadStreamByName('filename', ['revision' => -1]);

                            // Open the second most recent revision
                            $stream = $b->openDownloadStreamByName('filename', ['revision' => -2]);

                            // Open the original revision (i.e. 0th)
                            $stream = $b->openDownloadStreamByName('filename', ['revision' => 0]);

                            // Open the first revision
                            $stream = $b->openDownloadStreamByName('filename', ['revision' => 1]);
                            ```

                            * Same options for `downloadToStreamByName()`
                        </script>
                    </section>

                    <section data-markdown>
                        <script type="text/template">
                            ## Selecting a File Document

                            ```php
                            $id = new MongoDB\BSON\ObjectID('57f81b38da14d802e97b1b72');
                            $stream = $b->openDownloadStream($id);
                            var_dump($b->getFileDocumentForStream($stream));
                            ```

                            ```no-highlight
                            object(stdClass)#16 (6) {
                              ["_id"]=>
                              object(MongoDB\BSON\ObjectID)#18 (1) {
                                ["oid"]=>
                                string(24) "57f8228eda14d81806017242"
                              }
                              ["chunkSize"]=>
                              int(261120)
                              ["filename"]=>
                              string(8) "filename"
                              ["uploadDate"]=>
                              object(MongoDB\BSON\UTCDateTime)#21 (1) {
                                ["milliseconds"]=>
                                string(13) "1475879566662"
                              }
                              ["length"]=>
                              int(9)
                              ["md5"]=>
                              string(32) "d8d77109f4a24efc3bd53d7cabb7ee35"
                            }
                            ```
                        </script>
                    </section>

                    <section data-markdown>
                        <script type="text/template">
                            ## Deleting Files

                            ```php
                            // Delete a file (and related chunks) by its _id
                            $id = new MongoDB\BSON\ObjectID('57f81b38da14d802e97b1b72');
                            $b->delete($id);

                            // Drop the files and chunks collections
                            $b->drop();
                            ```

                            * No API for modifying files in-place
                                * Delete and re-upload, or create a new revision
                            * Random access with `fseek()` is not yet supported
                        </script>
                    </section>
                </section>
<!--
                <section>
                    <section data-background="img/earth.jpg">
                        <h1>Geospatial Indexing</h1>
                    </section>

                    <section data-markdown>
                        <script type="text/template">
                            ## [Geospatial Indexing](https://docs.mongodb.com/manual/core/geospatial-indexes/)

                            * Geo-hashed, 2D coordinates
                            * Legacy point format: `[x,y]`
                            * [GeoJSON](http://geojson.org/geojson-spec.html) for points/geometries
                            * One geospatial index per collection
                            * [Multi-location documents](https://docs.mongodb.com/manual/core/geospatial-indexes/#multi-location-documents-for-2d-indexes)
                            * [Spherical model support](https://docs.mongodb.com/manual/applications/geospatial-indexes/#spherical)
                        </script>
                    </section>

                    <section data-markdown>
                        <script type="text/template">
                            ## Data to Index

                            ```php
                            $c = (new MongoDB\Client)->test->places;

                            $c->insertOne([
                                'name' => 'Home',
                                'type' => 'residence',
                                'loc'  => [ 'type' => 'Point', 'coordinates' => [0, 0] ],
                            ]);

                            $c->insertOne([
                                'name' => 'Work',
                                'type' => 'office',
                                'loc'  => [ 'type' => 'Point', 'coordinates' => [12, 15] ],
                            ]);

                            $c->createIndex(['loc' => '2dsphere']);
                            ```
                        </script>
                    </section>

                    <section data-markdown>
                        <script type="text/template">
                            ## Bounds Queries

                            ```php
                            // Define a GeoJSON polgyon
                            $polygon = [
                                'type' => 'Polygon',
                                'coordinates' => [
                                    [ [10, 10], [10, 20], [20, 20], [20, 10], [10, 10] ],
                                ],
                            ];

                            // Find documents within the bounds
                            $c->find(['loc' => ['$geoWithin' => $polygon]]);

                            // Find documents within a circular bound
                            $c->find(['loc' => ['$geoWithin' => ['$centerSphere' => [
                                [5, 5], // Center coordinate
                                15,     // Radius
                            ]]]]);
                            ```
                        </script>
                    </section>

                    <section data-markdown>
                        <script type="text/template">
                            ## Sorted Proximity Queries

                            ```php
                            $point = ['type' => 'Point', 'coordinates' => [50, 50]];

                            // Find locations near a point, ordered by proximity
                            $c->find(['loc' => ['$near' => $point]]);

                            // Find at most 10 museums within 5 units of a point
                            $c->find(
                                [
                                    'loc' => ['$near' => $point, '$maxDistance' => 5],
                                    'type' => 'museum',
                                ],
                                ['limit' => 10]
                            );
                            ```
                        </script>
                    </section>

                    <section data-markdown>
                        <script type="text/template">
                            ## Sorted Proximity Queries

                            ```php
                            // geoNear command includes distance and diagnostic data
                            $db = (new MongoDB\Client)->test;
                            $db->command([
                                'geoNear' => 'places',
                                'near' => $point,
                                'maxDistance' => 5,
                                'query' => ['type' => 'museum'],
                                'num' => 10,
                            ]);
                            ```
                        </script>
                    </section>
                </section>
-->
                <section>
<!--
                    <section data-markdown>
                        <script type="text/template">
                            # <span class="mongodb-logo">MongoDB</span>

                            * API caters to you
                            * Features empower you
                            * Scales with you
                        </script>
                    </section>

                    <section data-background="img/companies.png">
                        <h1 class="hidden">Companies Using MongoDB</h1>
                    </section>
                </section>
-->
                <section data-markdown data-state="final">
                    <script type="text/template">
                        # Thanks!

                        * [Server downloads](https://www.mongodb.com/download-center) and [documentation](https://docs.mongodb.com/manual/)
                        * [PHP and HHVM extension documentation](http://php.net/manual/en/set.mongodb.php)
                        * [PHP library documentation](https://docs.mongodb.com/php-library/master/)
                        * [MongoDB University](https://university.mongodb.com) (free online education)
                        * [MongoDB Atlas](https://www.mongodb.com/cloud) (DBaaS)

                        ### Questions?
                    </script>
                </section>

                <section data-markdown data-state="photo-credits">
                    <script type="text/template">
                        ### Photo Credits

                        * [http://www.flickr.com/photos/paranoidfs/7312644738/](http://www.flickr.com/photos/paranoidfs/7312644738/)
                        * [http://www.flickr.com/photos/pagedooley/7330663394/](http://www.flickr.com/photos/pagedooley/7330663394/)
                        * [http://www.slxdeveloper.com/page.aspx?action=viewarticle&articleid=92](http://www.slxdeveloper.com/page.aspx?action=viewarticle&articleid=92)
                        * [http://www.sxc.hu/photo/487816](http://www.sxc.hu/photo/487816)
                        * [http://www.flickr.com/photos/sharynmorrow/2224102244/](http://www.flickr.com/photos/sharynmorrow/2224102244/)
                        * [http://www.flickr.com/photos/guangye/3234191654/](http://www.flickr.com/photos/guangye/3234191654/)
                        * [http://www.flickr.com/photos/spacebarpark/6712082295/](http://www.flickr.com/photos/spacebarpark/6712082295/)
                        * [http://www.flickr.com/photos/dierken/7998425310/](http://www.flickr.com/photos/dierken/7998425310/in/)
                        * [http://www.flickr.com/photos/69125796@N00/7415476606/](http://www.flickr.com/photos/69125796@N00/7415476606/)
                        * [http://www.sxc.hu/photo/443042](http://www.sxc.hu/photo/443042)
                        * [http://www.flickr.com/photos/mikebaird/3898801499/](http://www.flickr.com/photos/mikebaird/3898801499/)
                        * [http://history.nasa.gov/ap08fj/photos/a/as08-16-2593hr.jpg](http://history.nasa.gov/ap08fj/photos/a/as08-16-2593hr.jpg)
                    </script>
                </section>
            </div>
        </div>

        <script src="../vendor/reveal.js/lib/js/head.min.js"></script>
        <script src="../vendor/reveal.js/js/reveal.js"></script>
        <script src="../common/js/jquery-1.10.2.min.js"></script>
        <script src="../common/js/jquery.jsPlumb-1.5.2-min.js"></script>
        <script src="../common/js/reveal.js"></script>
        <script src="js/main.js"></script>
    </body>
</html>
